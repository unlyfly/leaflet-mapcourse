<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webmap Test</title>
    <link rel="stylesheet" href="src/css/leaflet.css" />
    <script src="src/js/leaflet.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script src="src/js/jquery.min.js" type="text/javascript"></script>

    <style>
      body {
        display: flex;
      }
      #mapdiv {
        block-size: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="side-bar" class="col-md-3">
      <button id='btnLocate' class='btn btn-primary btn-block'>Locate</button>
      <button id='btnPalacio' class='btn btn-primary btn-block'>ZoomToPalacio</button>
      <h4>Zoom Level: <span id='zoom-level'></span></h4>
      <h4>Map Center: <span id='map-center'></span></h4>
      <h4>Mouse Location: <span id='mouse-location'></span></h4>
    </div>
    <div id="mapdiv" class="col-md-9"></div>

    <script>
      var map1;
      var lyrOSM;
      var mrkCurrentLocation;
      var popPalacio;
      var popExample;

      $(document).ready(function () {
        map1 = L.map("mapdiv", {
          center: [32.50079, -116.932811],
          zoom: 12,
        });
        lyrOSM = L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png");
        map1.addLayer(lyrOSM);

        popPalacio = L.popup();
        popPalacio.setLatLng([32.5326, -117.0188]);
        popPalacio.setContent("<h4> Palacio Municipal de Tijuana <h4>");


        map1.on("click", function (e) {
          if (e.originalEvent.shiftKey) {
            alert(map1.getZoom());
          } else {
            alert(e.latlng.toString());
          }
        });

        map1.on("contextmenu", function (e) {
          var dateTime = new Date();
          L.marker(e.latlng)
            .addTo(map1)
            .bindPopup(e.latlng.toString() + dateTime);
        });

        map1.on("keypress", function (e) {
          if (e.originalEvent.key == "l") {
            console.log(e);
          }
        });

        map1.on("locationfound", function (e) {
          console.log(e);
          if (mrkCurrentLocation) {
            mrkCurrentLocation.remove();
          }
          mrkCurrentLocation = L.circle(e.latlng, {
            radius: e.accuracy / 2,
          }).addTo(map1);
          map1.setView(e.latlng, 14);
        });

        map1.on("locationerror", function (e) {
          console.log(e);
          alert("Lacalizacion no encontrada");
        });

        map1.on("zoomend", function () {
          document.getElementById('zoom-level').innerHTML = map1.getZoom();
        });

        map1.on("moveend", function () {
          document.getElementById('map-center').innerHTML = LatLngToArrayString(map1.getCenter());
        });

        map1.on("mousemove", function (e) {
          document.getElementById('mouse-location').innerHTML = LatLngToArrayString(e.latlng);
        });

        $("#btnLocate").click(function () {
          map1.locate();
        });

        $("#btnPalacio").click(function () {
          map1.setView([32.5326, -117.0188], 17);
          map1.openPopup(popPalacio);
        });
      });

      function LatLngToArrayString(ll) {
        console.log(ll);
        return "[" + ll.lat.toFixed(5) + ", " + ll.lng.toFixed(5) + "]";
      }
    </script>
  </body>
</html>
